<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fruit Market</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" type="image/webp" href="https://i.imgur.com/4cLbI3j.jpeg">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4ade80;
            --primary-light: #86efac;
            --primary-dark: #22c55e;
            --secondary: #f97316;
            --dark: #1e293b;
            --light: #f8fafc;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f1f5f9;
            color: var(--dark);
        }

        .hero-gradient {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        }

        .card-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            animation: slideIn 0.5s forwards, slideOut 0.5s forwards 2.5s;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }

        @keyframes slideOut {
            from { transform: translateX(0); }
            to { transform: translateX(100%); }
        }

        input:invalid {
            border-color: #ef4444;
        }

        input:valid:not(:placeholder-shown) {
            border-color: #4ade80;
        }
        
        /* Language toggle button styles */
        .lang-toggle {
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 6px 12px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .lang-toggle:hover {
            background-color: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }
        
        .lang-toggle.active {
            background-color: white;
            color: var(--primary-dark);
        }

        /* Dark mode styles */
        body.dark-mode {
            background-color: #1a202c;
            color: #e2e8f0;
        }

        .dark-mode .bg-white {
            background-color: #2d3748;
        }

        .dark-mode .text-gray-800, 
        .dark-mode .text-gray-700, 
        .dark-mode .text-gray-600, 
        .dark-mode .text-gray-500 {
            color: #e2e8f0;
        }

        .dark-mode .border,
        .dark-mode .border-t {
            border-color: #4a5568;
        }

        .dark-mode .bg-gray-100 {
            background-color: #4a5568;
        }

        .dark-mode .shadow-md {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5), 0 2px 4px -1px rgba(0, 0, 0, 0.3);
        }

        .dark-mode .card-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5), 0 2px 4px -1px rgba(0, 0, 0, 0.3);
        }

        .dark-mode .bg-gray-200 {
            background-color: #4a5568;
        }

        .dark-mode .text-gray-900 {
            color: #f7fafc;
        }

        .dark-mode #dark-mode-toggle i,
        .dark-mode #dark-mode-toggle-mobile i {
            color: #f6ad55;
        }

        .dark-mode .lang-toggle {
            background-color: rgba(74, 85, 104, 0.5);
        }

        .dark-mode .lang-toggle.active {
            background-color: #f6ad55;
            color: #2d3748;
        }

        .dark-mode .notification {
            background-color: #2d3748;
            color: #e2e8f0;
        }
        
        /* User table styles */
        .user-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .user-table th {
            background-color: #f1f5f9;
            text-align: left;
            padding: 12px 15px;
            font-weight: 600;
        }
        
        .user-table td {
            padding: 10px 15px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .user-table tr:nth-child(even) {
            background-color: #f8fafc;
        }
        
        .user-table tr:hover {
            background-color: #f1f5f9;
        }
        
        .dark-mode .user-table th {
            background-color: #2d3748;
        }
        
        .dark-mode .user-table td {
            border-bottom: 1px solid #4a5568;
        }
        
        .dark-mode .user-table tr:nth-child(even) {
            background-color: #2d3748;
        }
        
        .dark-mode .user-table tr:hover {
            background-color: #4a5568;
        }
        
        .security-warning {
            background-color: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 16px;
            margin-top: 20px;
            border-radius: 4px;
        }
        
        .dark-mode .security-warning {
            background-color: #453209;
            border-left-color: #f59e0b;
        }
        
        /* Name badges */
        .name-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 500;
            margin-right: 6px;
        }
        
        .account-badge {
            background-color: #dbeafe;
            color: #1d4ed8;
            border: 1px solid #bfdbfe;
        }
        
        .customer-badge {
            background-color: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
        }
        
        .dark-mode .account-badge {
            background-color: #1e3a8a;
            color: #dbeafe;
            border-color: #3b82f6;
        }
        
        .dark-mode .customer-badge {
            background-color: #14532d;
            color: #dcfce7;
            border-color: #22c55e;
        }

        /* Logo styles */
        #logo-link {
            transition: transform 0.3s ease;
        }
        
        #logo-link:hover {
            transform: scale(1.05);
        }
        
        #logo-link img {
            max-height: 60px;
            width: auto;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .dark-mode #logo-link img {
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>
    <!-- Firebase SDK -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";
        import { getFirestore, collection, addDoc, getDocs, doc, setDoc, updateDoc, deleteDoc, query, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDnBGCDc3IKJtqCQpqwUqnOCSCoh0uuUNg",
            authDomain: "fruitmarket-bc8bb.firebaseapp.com",
            projectId: "fruitmarket-bc8bb",
            storageBucket: "fruitmarket-bc8bb.appspot.com",
            messagingSenderId: "541776355278",
            appId: "1:541776355278:web:30876557d43f4540df159f",
            measurementId: "G-ZXPB05F7B6"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const db = getFirestore(app);

        // Make Firebase available globally
        window.firebase = {
            db,
            collection,
            addDoc,
            getDocs,
            doc,
            setDoc,
            updateDoc,
            deleteDoc,
            query,
            where
        };
    </script>

    <!-- Navbar -->
    <nav class="bg-white shadow-md sticky top-0 z-50 dark:bg-gray-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <!-- Left side (empty to balance the logo in center) -->
                <div class="flex items-center w-1/4">
                    <!-- This empty div helps center the logo -->
                </div>
                
                <!-- Center Logo -->
                <div class="flex items-center justify-center w-1/2">
                    <a href="#" id="logo-link" class="flex items-center justify-center">
                        <img src="https://i.imgur.com/4cLbI3j.jpeg" 
                             alt="Fruit Market Logo" 
                             class="h-12 w-auto hover:opacity-90 transition-opacity duration-200">
                    </a>
                </div>
                
                <!-- Right side (menu items) -->
                <div class="flex items-center w-1/4 justify-end">
                    <div class="hidden md:flex items-center space-x-4">
                        <button id="home-tab" class="text-gray-700 hover:text-green-600 px-3 py-2 rounded-md text-sm font-medium dark:text-gray-300 dark:hover:text-green-400" data-key="home">Home</button>
                        <button id="products-tab" class="text-gray-700 hover:text-green-600 px-3 py-2 rounded-md text-sm font-medium dark:text-gray-300 dark:hover:text-green-400" data-key="products">Products</button>
                        <button id="orders-tab" class="text-gray-700 hover:text-green-600 px-3 py-2 rounded-md text-sm font-medium dark:text-gray-300 dark:hover:text-green-400" data-key="orders">My Orders</button>
                        <button id="auth-tab" class="text-gray-700 hover:text-green-600 px-3 py-2 rounded-md text-sm font-medium dark:text-gray-300 dark:hover:text-green-400" data-key="login">Login</button>
                        <button id="admin-tab" class="hidden bg-yellow-500 text-white px-3 py-2 rounded-md text-sm font-medium" data-key="admin">Admin</button>
                        <!-- Language Toggle Button -->
                        <div class="flex space-x-1 bg-gray-100 rounded-full p-1 dark:bg-gray-700">
                            <button id="lang-en" class="lang-toggle active" data-lang="en">EN</button>
                            <button id="lang-fr" class="lang-toggle" data-lang="fr">FR</button>
                        </div>
                        <!-- Dark Mode Toggle Button -->
                        <button id="dark-mode-toggle" class="p-2 rounded-full focus:outline-none">
                            <i class="fas fa-moon text-gray-700 dark:text-yellow-400"></i>
                        </button>
                    </div>
                    <div class="-mr-2 flex md:hidden">
                        <button id="mobile-menu-button" class="inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-green-500 dark:hover:bg-gray-700">
                            <span class="sr-only">Open main menu</span>
                            <i class="fas fa-bars"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mobile menu -->
        <div id="mobile-menu" class="hidden md:hidden">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <button id="home-tab-mobile" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-green-600 hover:bg-gray-50 w-full text-left dark:text-gray-300 dark:hover:text-green-400 dark:hover:bg-gray-700" data-key="home">Home</button>
                <button id="products-tab-mobile" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-green-600 hover:bg-gray-50 w-full text-left dark:text-gray-300 dark:hover:text-green-400 dark:hover:bg-gray-700" data-key="products">Products</button>
                <button id="orders-tab-mobile" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-green-600 hover:bg-gray-50 w-full text-left dark:text-gray-300 dark:hover:text-green-400 dark:hover:bg-gray-700" data-key="orders">My Orders</button>
                <button id="auth-tab-mobile" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-green-600 hover:bg-gray-50 w-full text-left dark:text-gray-300 dark:hover:text-green-400 dark:hover:bg-gray-700" data-key="login">Login</button>
                <button id="admin-tab-mobile" class="hidden bg-yellow-500 text-white px-3 py-2 rounded-md text-base font-medium w-full text-left" data-key="admin">Admin</button>
                <!-- Mobile Language Toggle -->
                <div class="flex justify-center space-x-1 bg-gray-100 rounded-full p-1 mt-2 dark:bg-gray-700">
                    <button id="lang-en-mobile" class="lang-toggle active" data-lang="en">EN</button>
                            <button id="lang-fr-mobile" class="lang-toggle" data-lang="fr">FR</button>
                        </div>
                        <!-- Dark Mode Toggle Button for Mobile -->
                        <button id="dark-mode-toggle-mobile" class="w-full flex justify-center items-center p-2 mt-2 rounded-full focus:outline-none">
                            <i class="fas fa-moon text-gray-700 dark:text-yellow-400 mr-2"></i>
                            <span data-key="dark_mode">Dark Mode</span>
                        </button>
                    </div>
                </div>
            </nav>

            <!-- Main Content -->
            <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                <!-- Home Tab -->
                <div id="home-content" class="tab-content active">
                    <div class="hero-gradient rounded-xl p-8 text-white mb-8">
                        <h1 class="text-4xl font-bold mb-4" data-key="hero_title">Fresh Fruits Delivered to Your Doorstep</h1>
                        <p class="text-xl mb-6" data-key="hero_text">Order the freshest seasonal fruits from our local farmers. Organic, delicious, and packed with nutrients!</p>
                        <button id="order-now-btn" class="bg-white text-green-600 px-6 py-3 rounded-lg font-bold hover:bg-gray-100 transition duration-300" data-key="order_now">Order Now</button>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div class="bg-white rounded-lg p-6 card-shadow dark:bg-gray-800">
                            <i class="fas fa-shipping-fast text-4xl text-green-500 mb-4"></i>
                            <h3 class="text-xl font-bold mb-2 dark:text-white" data-key="fast_delivery">Fast Delivery</h3>
                            <p class="text-gray-600 dark:text-gray-300" data-key="delivery_text">Get your fruits delivered within 24 hours of ordering.</p>
                        </div>
                        <div class="bg-white rounded-lg p-6 card-shadow dark:bg-gray-800">
                            <i class="fas fa-seedling text-4xl text-green-500 mb-4"></i>
                            <h3 class="text-xl font-bold mb-2 dark:text-white" data-key="organic">100% Organic</h3>
                            <p class="text-gray-600 dark:text-gray-300" data-key="organic_text">All our fruits are grown without pesticides or artificial chemicals.</p>
                        </div>
                        <div class="bg-white rounded-lg p-6 card-shadow dark:bg-gray-800">
                            <i class="fas fa-money-bill-wave text-4xl text-green-500 mb-4"></i>
                            <h3 class="text-xl font-bold mb-2 dark:text-white" data-key="best_prices">Best Prices</h3>
                            <p class="text-gray-600 dark:text-gray-300" data-key="prices_text">Competitive prices straight from local farmers to your table.</p>
                        </div>
                    </div>

                    <h2 class="text-2xl font-bold mb-4 dark:text-white" data-key="featured_fruits">Featured Fruits</h2>
                    <div id="featured-fruits" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                        <!-- Featured fruits will be loaded here -->
                    </div>
                </div>

                <!-- Products Tab -->
                <div id="products-content" class="tab-content">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold dark:text-white" data-key="fruit_selection">Our Fruit Selection</h2>
                        <div class="relative">
                            <input type="text" id="fruit-search" placeholder="Search fruits..." class="pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" data-key-placeholder="search_placeholder">
                            <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                        </div>
                    </div>
                    
                    <div id="all-fruits" class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6">
                        <!-- All fruits will be loaded here -->
                    </div>
                </div>

                <!-- Order Placement Tab -->
                <div id="order-content" class="tab-content">
                    <h2 class="text-2xl font-bold mb-6 dark:text-white" data-key="place_order">Place Your Order</h2>
                    <form id="order-form" class="bg-white rounded-lg p-6 card-shadow max-w-2xl mx-auto dark:bg-gray-800">
                        <!-- Added Name Field -->
                        <div class="mb-4">
                            <label for="customer-name" class="block text-gray-700 font-medium mb-2 dark:text-gray-300" data-key="customer_name">Recipient Name</label>
                            <input type="text" id="customer-name" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Enter recipient's name" required>
                            <p class="text-xs text-gray-500 mt-1 dark:text-gray-400">Name of the person receiving the fruits</p>
                        </div>
                        
                        <div class="mb-4">
                            <label for="fruit-select" class="block text-gray-700 font-medium mb-2 dark:text-gray-300" data-key="select_fruit">Select Fruit</label>
                            <select id="fruit-select" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" required>
                                <option value="" data-key="choose_fruit">Choose a fruit...</option>
                                <!-- Fruits will be populated here -->
                            </select>
                        </div>
                        
                        <div class="mb-4">
                            <label for="quantity" class="block text-gray-700 font-medium mb-2 dark:text-gray-300" data-key="quantity">Quantity (kg)</label>
                            <input type="number" id="quantity" min="1" step="0.1" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Minimum 1 kg" required data-key-placeholder="min_kg">
                        </div>

                        <div class="mb-4">
                            <label for="special-instructions" class="block text-gray-700 font-medium mb-2 dark:text-gray-300" data-key="special_instructions">Adresse</label>
                            <textarea id="special-instructions" rows="3" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Any ripeness preferences or special requests..." data-key-placeholder="instructions_placeholder"></textarea>
                        </div>

                        <div class="mb-6">
                            <div class="flex justify-between items-center bg-gray-100 p-4 rounded-lg dark:bg-gray-700">
                                <span class="font-medium dark:text-gray-300" data-key="total_price">Total Price:</span>
                                <span id="total-price" class="text-xl font-bold text-green-600">0.00 DH</span>
                            </div>
                        </div>

                        <button type="submit" class="w-full bg-green-500 text-white py-3 rounded-lg font-bold hover:bg-green-600 transition duration-300" data-key="submit_order">
                            Place Order
                        </button>
                    </form>
                </div>

                <!-- Orders Tab -->
                <div id="orders-content" class="tab-content">
                    <h2 class="text-2xl font-bold mb-6 dark:text-white" data-key="my_orders">My Orders</h2>
                    
                    <div class="flex space-x-4 mb-6">
                        <button id="current-orders-tab" class="px-4 py-2 border-b-2 border-green-500 text-green-600 font-medium dark:text-green-400" data-key="current_orders">Current Orders</button>
                        <button id="past-orders-tab" class="px-4 py-2 text-gray-500 font-medium dark:text-gray-400" data-key="past_orders">Past Orders</button>
                    </div>
                    
                    <div id="current-orders-section">
                        <h3 class="text-lg font-semibold mb-4 dark:text-white" data-key="current_orders">Current Orders</h3>
                        <div id="current-orders-list" class="space-y-4">
                            <!-- Current orders will be loaded here -->
                        </div>
                    </div>
                    
                    <div id="past-orders-section" class="hidden">
                        <h3 class="text-lg font-semibold mb-4 dark:text-white" data-key="past_orders">Past Orders</h3>
                        <div id="past-orders-list" class="space-y-4">
                            <!-- Past orders will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Authentication Tab -->
                <div id="auth-content" class="tab-content">
                    <div class="flex flex-col md:flex-row gap-8">
                        <!-- Login Form -->
                        <div class="bg-white rounded-lg p-6 card-shadow flex-1 max-w-md mx-auto dark:bg-gray-800">
                            <h2 class="text-2xl font-bold mb-6 text-center dark:text-white" data-key="login_title">Login</h2>
                            <form id="login-form">
                                <div class="mb-4">
                                    <label for="login-email" class="block text-gray-700 font-medium mb-2 dark:text-gray-300" data-key="email">Email</label>
                                    <input type="email" id="login-email" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="your@email.com" required>
                                </div>
                                
                                <div class="mb-4">
                                    <label for="login-password" class="block text-gray-700 font-medium mb-2 dark:text-gray-300" data-key="password">Password</label>
                                    <input type="password" id="login-password" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="••••••••" required>
                                </div>
                                
                                <button type="submit" class="w-full bg-green-500 text-white py-3 rounded-lg font-bold hover:bg-green-600 transition duration-300 mb-4" data-key="login">
                                    Login
                                </button>
                                
                                <div class="text-center">
                                    <button id="show-register" class="text-green-600 hover:text-green-800 font-medium dark:text-green-400 dark:hover:text-green-300" data-key="register_prompt">
                                        Don't have an account? Register
                                    </button>
                                </div>
                            </form>
                        </div>
                        
                        <!-- Register Form -->
                        <div id="register-form-container" class="bg-white rounded-lg p-6 card-shadow flex-1 max-w-md mx-auto hidden dark:bg-gray-800">
                            <h2 class="text-2xl font-bold mb-6 text-center dark:text-white" data-key="register_title">Register</h2>
                            <form id="register-form">
                                <div class="mb-4">
                                    <label for="register-name" class="block text-gray-700 font-medium mb-2 dark:text-gray-300" data-key="full_name">Full Name</label>
                                    <input type="text" id="register-name" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="John Doe" required>
                                </div>
                                
                                <div class="mb-4">
                                    <label for="register-phone" class="block text-gray-700 font-medium mb-2 dark:text-gray-300" data-key="phone">Phone Number</label>
                                    <input type="tel" id="register-phone" pattern="[0-9]{10}" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="0612345678" required>
                                    <p class="text-xs text-gray-500 mt-1 dark:text-gray-400" data-key="phone_format">Format: 10 digits (e.g., 0612345678)</p>
                                </div>
                                
                                <div class="mb-4">
                                    <label for="register-email" class="block text-gray-700 font-medium mb-2 dark:text-gray-300" data-key="email">Email</label>
                                    <input type="email" id="register-email" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="your@email.com" required>
                                </div>
                                
                                <div class="mb-4">
                                    <label for="register-password" class="block text-gray-700 font-medium mb-2 dark:text-gray-300" data-key="password">Password</label>
                                    <input type="password" id="register-password" minlength="6" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="••••••••" required>
                                    <p class="text-xs text-gray-500 mt-1 dark:text-gray-400" data-key="password_length">Minimum 6 characters</p>
                                </div>
                                
                                <button type="submit" class="w-full bg-green-500 text-white py-3 rounded-lg font-bold hover:bg-green-600 transition duration-300 mb-4" data-key="register">
                                    Register
                                </button>
                                
                                <div class="text-center">
                                    <button id="show-login" class="text-green-600 hover:text-green-800 font-medium dark:text-green-400 dark:hover:text-green-300" data-key="login_prompt">
                                        Already have an account? Login
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Admin Tab -->
                <div id="admin-content" class="tab-content hidden">
                    <div class="flex flex-col md:flex-row gap-8">
                        <!-- Admin Login -->
                        <div id="admin-login-form-container" class="bg-white rounded-lg p-6 card-shadow flex-1 max-w-md mx-auto dark:bg-gray-800">
                            <h2 class="text-2xl font-bold mb-6 text-center dark:text-white" data-key="admin_login">Admin Login</h2>
                            <form id="admin-login-form">
                                <div class="mb-4">
                                    <label for="admin-username" class="block text-gray-700 font-medium mb-2 dark:text-gray-300" data-key="username">Username</label>
                                    <input type="text" id="admin-username" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="admin" required>
                                </div>
                                
                                <div class="mb-4">
                                    <label for="admin-password" class="block text-gray-700 font-medium mb-2 dark:text-gray-300" data-key="password">Password</label>
                                    <input type="password" id="admin-password" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="••••••••" required>
                                </div>
                                
                                <button type="submit" class="w-full bg-yellow-500 text-white py-3 rounded-lg font-bold hover:bg-yellow-600 transition duration-300" data-key="login">
                                    Login
                                </button>
                            </form>
                        </div>

                        <!-- Admin Dashboard -->
                        <div id="admin-dashboard-container" class="flex-1 hidden">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-2xl font-bold dark:text-white" data-key="admin_dashboard">Admin Dashboard</h2>
                                <div class="flex space-x-2">
                                    <button id="manage-products-tab" class="px-4 py-2 bg-green-500 text-white rounded-lg font-medium" data-key="manage_products">Products</button>
                                    <button id="manage-orders-tab" class="px-4 py-2 bg-blue-500 text-white rounded-lg font-medium" data-key="manage_orders">Orders</button>
                                    <!-- NEW: User Management Button -->
                                    <button id="manage-users-tab" class="px-4 py-2 bg-purple-500 text-white rounded-lg font-medium">User Management</button>
                                </div>
                            </div>

                            <!-- Products Management -->
                            <div id="manage-products-section">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-xl font-semibold dark:text-white" data-key="fruit_products">Fruit Products</h3>
                                    <button id="add-product-btn" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition duration-300">
                                        <i class="fas fa-plus mr-2"></i><span data-key="add_product">Add Product</span>
                                    </button>
                                </div>

                                <div id="products-list-admin" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    <!-- Products will be listed here for admin to manage -->
                                </div>
                            </div>

                            <!-- Orders Management -->
                            <div id="manage-orders-section" class="hidden">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-xl font-semibold dark:text-white" data-key="customer_orders">Customer Orders</h3>
                                    <div class="flex items-center space-x-2">
                                        <select id="order-filter" class="px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                            <option value="all" data-key="all_orders">All Orders</option>
                                            <option value="pending" data-key="pending">Pending</option>
                                            <option value="confirmed" data-key="confirmed">Confirmed</option>
                                            <option value="cancelled" data-key="cancelled">Cancelled</option>
                                        </select>
                                    </div>
                                </div>

                                <div id="orders-list-admin" class="space-y-4">
                                    <!-- Orders will be listed here for admin to manage -->
                                </div>
                            </div>
                            
                            <!-- NEW: User Management Section -->
                            <div id="manage-users-section" class="hidden">
                                <h3 class="text-xl font-semibold mb-4 dark:text-white">User Management</h3>
                                
                                <div class="bg-white rounded-lg p-6 shadow dark:bg-gray-800">
                                    <h4 class="text-lg font-medium mb-4 dark:text-white">User Credentials</h4>
                                    
                                    <table class="user-table">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>Name</th>
                                                <th>Email</th>
                                                <th>Phone</th>
                                                <th>Password</th>
                                                <th>Admin</th>
                                            </tr>
                                        </thead>
                                        <tbody id="users-list-admin">
                                            <!-- Users will be populated here -->
                                        </tbody>
                                    </table>
                                    
                                    <div class="security-warning mt-6">
                                        <h4 class="font-bold mb-2 dark:text-yellow-300">Security Warning</h4>
                                        <p class="dark:text-yellow-100">
                                            Storing passwords in plain text is a severe security vulnerability. 
                                            This implementation is for demonstration purposes only. In production, 
                                            always use password hashing with salt (e.g., bcrypt) to securely store credentials.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Add Product Modal -->
                <div id="add-product-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
                    <div class="bg-white rounded-lg p-6 w-full max-w-md dark:bg-gray-800">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-bold dark:text-white" data-key="add_new_product">Add New Product</h3>
                            <button id="close-add-product-modal" class="text-gray-500 hover:text-gray-700 dark:text-gray-300 dark:hover:text-gray-100">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        
                        <form id="add-product-form">
                            <div class="mb-4">
                                <label for="product-name" class="block text-gray-700 font-medium mb-2 dark:text-gray-300" data-key="fruit_name">Fruit Name</label>
                                <input type="text" id="product-name" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" required>
                            </div>
                            
                            <div class="mb-4">
                                <label for="product-price" class="block text-gray-700 font-medium mb-2 dark:text-gray-300" data-key="price_kg">Price per kg (DH)</label>
                                <input type="number" id="product-price" min="0" step="0.1" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" required>
                            </div>
                            
                            <div class="mb-4">
                                <label for="product-image" class="block text-gray-700 font-medium mb-2 dark:text-gray-300" data-key="image_url">Image URL</label>
                                <input type="text" id="product-image" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="https://example.com/image.jpg" required>
                                <p class="text-xs text-gray-500 mt-1 dark:text-gray-400" data-key="image_placeholder">For demo purposes, paste any image URL</p>
                            </div>
                            
                            <div class="mb-4">
                                <label for="product-description" class="block text-gray-700 font-medium mb-2 dark:text-gray-300" data-key="description">Description</label>
                                <textarea id="product-description" rows="3" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"></textarea>
                            </div>
                            
                            <button type="submit" class="w-full bg-green-500 text-white py-3 rounded-lg font-bold hover:bg-green-600 transition duration-300" data-key="add_product">
                                Add Product
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Edit Product Modal -->
                <div id="edit-product-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
                    <div class="bg-white rounded-lg p-6 w-full max-w-md dark:bg-gray-800">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-bold dark:text-white" data-key="edit_product">Edit Product</h3>
                            <button id="close-edit-product-modal" class="text-gray-500 hover:text-gray-700 dark:text-gray-300 dark:hover:text-gray-100">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        
                        <form id="edit-product-form">
                            <input type="hidden" id="edit-product-id">
                            <div class="mb-4">
                                <label for="edit-product-name" class="block text-gray-700 font-medium mb-2 dark:text-gray-300" data-key="fruit_name">Fruit Name</label>
                                <input type="text" id="edit-product-name" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" required>
                            </div>
                            
                            <div class="mb-4">
                                <label for="edit-product-price" class="block text-gray-700 font-medium mb-2 dark:text-gray-300" data-key="price_kg">Price per kg (DH)</label>
                                <input type="number" id="edit-product-price" min="0" step="0.1" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" required>
                            </div>
                            
                            <div class="mb-4">
                                <label for="edit-product-image" class="block text-gray-700 font-medium mb-2 dark:text-gray-300" data-key="image_url">Image URL</label>
                                <input type="text" id="edit-product-image" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" required>
                            </div>
                            
                            <div class="mb-4">
                                <label for="edit-product-description" class="block text-gray-700 font-medium mb-2 dark:text-gray-300" data-key="description">Description</label>
                                <textarea id="edit-product-description" rows="3" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"></textarea>
                            </div>
                            
                            <div class="flex space-x-2">
                                <button type="submit" class="flex-1 bg-green-500 text-white py-3 rounded-lg font-bold hover:bg-green-600 transition duration-300" data-key="update">
                                    Update
                                </button>
                                <button id="delete-product-btn" type="button" class="flex-1 bg-red-500 text-white py-3 rounded-lg font-bold hover:bg-red-600 transition duration-300" data-key="delete">
                                    Delete
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </main>

            <!-- Footer -->
            <footer class="bg-white border-t mt-12 dark:bg-gray-800 dark:border-gray-700">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <div>
                            <h3 class="text-lg font-medium text-gray-900 mb-4 dark:text-white" data-key="app_name">Fruit Market</h3>
                            <p class="text-gray-500 dark:text-gray-400" data-key="footer_slogan">Bringing fresh, organic fruits from local farmers to your table.</p>
                        </div>
                        <div>
                            <h3 class="text-lg font-medium text-gray-900 mb-4 dark:text-white" data-key="quick_links">Quick Links</h3>
                            <ul class="space-y-2">
                                <li><button id="footer-products" class="text-gray-600 hover:text-green-600 dark:text-gray-400 dark:hover:text-green-400" data-key="products">Products</button></li>
                                <li><button id="footer-orders" class="text-gray-600 hover:text-green-600 dark:text-gray-400 dark:hover:text-green-400" data-key="orders">My Orders</button></li>
                                <li><button id="footer-login" class="text-gray-600 hover:text-green-600 dark:text-gray-400 dark:hover:text-green-400" data-key="login">Login/Register</button></li>
                            </ul>
                        </div>
                        <div>
                            <h3 class="text-lg font-medium text-gray-900 mb-4 dark:text-white" data-key="contact_us">Contact Us</h3>
                            <ul class="space-y-2">
                                <li class="flex items-center text-gray-600 dark:text-gray-400"><i class="fas fa-phone-alt mr-2"></i> </li>
                                <li class="flex items-center text-gray-600 dark:text-gray-400"><i class="fas fa-envelope mr-2"></i> contact@fruitmarket.com</li>
                                <li class="flex items-center text-gray-600 dark:text-gray-400"><i class="fas fa-map-marker-alt mr-2"></i> Casablanca, Morocco</li>
                            </ul>
                        </div>
                    </div>
                    <div class="mt-8 pt-8 border-t border-gray-200 text-center text-gray-500 text-sm dark:border-gray-700 dark:text-gray-400">
                        &copy; 2025 Fruit Market. <span data-key="rights">All rights reserved.</span>
                    </div>
                </div>
            </footer>

            <!-- Notification -->
            <div id="notification" class="notification hidden">
                <div class="bg-green-500 text-white px-6 py-4 rounded-lg shadow-lg dark:bg-green-600">
                    <div class="flex items-center">
                        <i id="notification-icon" class="fas fa-check-circle mr-2"></i>
                        <span id="notification-message">Operation successful!</span>
                    </div>
                </div>
            </div>

            <script>
                // Database simulation for products (still in memory)
                let products = [
                    {
                        id: 1,
                        name: "Apple-تفاح",
                        price: 10,
                        image: "https://cdn.britannica.com/22/187222-050-07B17FB6/apples-on-a-tree-branch.jpg?w=300",
                        description: "Fresh, crisp and sweet red apples from our local orchards."
                    },
                    {
                        id: 2,
                        name: "Banana-موز",
                        price: 10,
                        image: "https://nutritionsource.hsph.harvard.edu/wp-content/uploads/2018/08/bananas-1354785_1920-1024x683.jpg",
                        description: "Organic bananas, ripen at home for perfect sweetness."
                    },
                    {
                        id: 3,
                        name: "Orange-برتقال",
                        price: 14,
                        image: "https://cdn.britannica.com/24/174524-050-A851D3F2/Oranges.jpg",
                        description: "Juicy Moroccan oranges, packed with vitamin C."
                    },
                    {
                        id: 4,
                        name: "fraise-فَرَاوِلَة",
                        price: 10,
                        image: "https://cdn.futura-sciences.com/sources/images/qr/Celine/fraise%20fruit%20%20red150770%2C%20Adobe%20Stock.jpeg",
                        description: "Sweet and fragrant fraise, hand-picked daily."
                    },
                    {
                        id: 5,
                        name: "Kiwi-كيوي",
                        price: 12,
                        image: "https://upload.wikimedia.org/wikipedia/commons/d/d3/Kiwi_aka.jpg",
                        description: "Fresh and tangy kiwis, rich in vitamin C and antioxidants."
                    },
                    {
                        id: 6,
                        name: "blueberries-توت أزرق",
                        price: 18,
                        image: "https://www.foodandwine.com/thmb/n4ZamE93pZvh9XtWGaerxGahnX8=/1500x0/filters:no_upscale():max_bytes(150000):strip_icc()/Heres-Why-Blueberries-Appear-to-Be-Blue-According-to-Science-FT-BLOG0324-c3b02b5496ae4fd5b4fe9c2ba395d4ae.jpg",
                        description: "Fresh, juicy full of flavor."
                    },
                                        {
                        id: 7,
                        name: "jj",
                        price: 20,
                        image: "https://th.bing.com/th/id/R.b219cff47981edaacdd87481b0f677ad?rik=Kl%2byblAxtIA4vQ&riu=http%3a%2f%2fdraxe.com%2fwp-content%2fuploads%2f2015%2f05%2fbigstock-Watermelon-Is-Sold-At-The-Baza-90952598.jpg&ehk=uL%2fD361yIDcrrp0NjYtNem1rVaclsvUbM64NVLK4yXw%3d&risl=&pid=ImgRaw&r=0",
                        description: "Fresh."
                    }

                ];

                // Current user state
                let currentUser = null;
                let adminLoggedIn = false;
                
                // Language state
                let currentLanguage = localStorage.getItem('preferredLanguage') || 'en';
                
                // Dark mode state
                const prefersDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
                const savedDarkMode = localStorage.getItem('darkMode') === 'true';
                let darkMode = savedDarkMode || prefersDarkMode;
                
                // Translation dictionary
                const translations = {
                    en: {
                        // Navbar
                        'app_name': 'Fruit Market',
                        'home': 'Home',
                        'products': 'Products',
                        'orders': 'My Orders',
                        'login': 'Login',
                        'logout': 'Logout',
                        'admin': 'Admin',
                        'admin_dashboard': 'Admin Dashboard',
                        'dark_mode': 'Dark Mode',
                        
                        // Home tab
                        'hero_title': 'Fresh Fruits Delivered to Your Doorstep',
                        'hero_text': 'Order the freshest seasonal fruits from our local farmers. Organic, delicious, and packed with nutrients!',
                        'order_now': 'Order Now',
                        'fast_delivery': 'Fast Delivery',
                        'delivery_text': 'Get your fruits delivered within 24 hours of ordering.',
                        'organic': '100% Organic',
                        'organic_text': 'All our fruits are grown without pesticides or artificial chemicals.',
                        'best_prices': 'Best Prices',
                        'prices_text': 'Competitive prices straight from local farmers to your table.',
                        'featured_fruits': 'Featured Fruits',
                        
                        // Products tab
                        'fruit_selection': 'Our Fruit Selection',
                        'search_placeholder': 'Search fruits...',
                        
                        // Order tab
                        'place_order': 'Place Your Order',
                        'customer_name': 'Recipient Name',
                        'select_fruit': 'Select Fruit',
                        'choose_fruit': 'Choose a fruit...',
                        'quantity': 'Quantity (kg)',
                        'min_kg': 'Minimum 1 kg',
                        'special_instructions': 'Adresse',
                        'instructions_placeholder': 'Enter your adresse',
                        'total_price': 'Total Price:',
                        'submit_order': 'Place Order',
                        
                        // Orders tab
                        'my_orders': 'My Orders',
                        'current_orders': 'Current Orders',
                        'past_orders': 'Past Orders',
                        
                        // Auth tab
                        'login_title': 'Login',
                        'email': 'Email',
                        'password': 'Password',
                        'register_prompt': 'Don\'t have an account? Register',
                        'register_title': 'Register',
                        'full_name': 'Full Name',
                        'phone': 'Phone Number',
                        'phone_format': 'Format: 10 digits (e.g., 0612345678)',
                        'password_length': 'Minimum 6 characters',
                        'login_prompt': 'Already have an account? Login',
                        
                        // Admin tab
                        'admin_login': 'Admin Login',
                        'username': 'Username',
                        'manage_products': 'Products',
                        'manage_orders': 'Orders',
                        'add_product': 'Add Product',
                        'customer_orders': 'Customer Orders',
                        'all_orders': 'All Orders',
                        'pending': 'Pending',
                        'confirmed': 'Confirmed',
                        'cancelled': 'Cancelled',
                        'add_new_product': 'Add New Product',
                        'fruit_name': 'Fruit Name',
                        'price_kg': 'Price per kg (DH)',
                        'image_url': 'Image URL',
                        'image_placeholder': 'For demo purposes, paste any image URL',
                        'description': 'Description',
                        'edit_product': 'Edit Product',
                        'update': 'Update',
                        'delete': 'Delete',
                        
                        // Footer
                        'quick_links': 'Quick Links',
                        'contact_us': 'Contact Us',
                        'footer_slogan': 'Bringing fresh, organic fruits from local farmers to your table.',
                        'rights': 'All rights reserved.',
                        
                        // Notifications and other
                        'order_success': 'Order placed successfully!',
                        'login_success': 'Logged in successfully',
                        'logout_success': 'Logged out successfully',
                        'register_success': 'Registration successful! You are now logged in.',
                        'admin_login_success': 'Admin login successful',
                        'product_added': 'Product added successfully',
                        'product_updated': 'Product updated successfully',
                        'product_deleted': 'Product deleted successfully',
                        'order_confirmed': 'Order confirmed successfully',
                        'order_cancelled': 'Order cancelled successfully',
                        'login_required': 'Please login to place orders',
                        'invalid_order': 'Please select a fruit and enter a valid quantity',
                        'invalid_credentials': 'Invalid email or password',
                        'invalid_phone': 'Please enter a valid 10-digit phone number',
                        'invalid_email': 'Please enter a valid email address',
                        'email_exists': 'Email already registered',
                        'invalid_admin': 'Invalid admin credentials',
                        'fill_required': 'Please fill in all required fields',
                        'confirm_delete': 'Are you sure you want to delete this product?'
                    },
                    fr: {
                        // Navbar
                        'app_name': 'Marché de Fruits',
                        'home': 'Accueil',
                        'products': 'Produits',
                        'orders': 'Mes Commandes',
                        'login': 'Connexion',
                        'logout': 'Déconnexion',
                        'admin': 'Admin',
                        'admin_dashboard': 'Tableau de bord Admin',
                        'dark_mode': 'Mode Sombre',
                        
                        // Home tab
                        'hero_title': 'Des Fruits Frais Livrés à Votre Porte',
                        'hero_text': 'Commandez les fruits de saison les plus frais de nos agriculteurs locaux. Biologiques, délicieux et pleins de nutriments !',
                        'order_now': 'Commander Maintenant',
                        'fast_delivery': 'Livraison Rapide',
                        'delivery_text': 'Recevez vos fruits le plus vite possible.',
                        'organic': '100% Biologique',
                        'organic_text': 'Tous nos fruits sont cultivés sans pesticides ni produits chimiques artificiels.',
                        'best_prices': 'Meilleurs Prix',
                        'prices_text': 'Prix compétitifs directement des agriculteurs locaux à votre table.',
                        'featured_fruits': 'Fruits en Vedette',
                        
                        // Products tab
                        'fruit_selection': 'Notre Sélection de Fruits',
                        'search_placeholder': 'Rechercher des fruits...',
                        
                        // Order tab
                        'place_order': 'Passer Votre Commande',
                        'customer_name': 'Nom du destinataire',
                        'select_fruit': 'Sélectionner un Fruit',
                        'choose_fruit': 'Choisissez un fruit...',
                        'quantity': 'Quantité (kg)',
                        'min_kg': 'Minimum 1 kg',
                        'special_instructions': 'Adresse',
                        'instructions_placeholder': 'Entrer votre adresse',
                        'total_price': 'Prix Total:',
                        'submit_order': 'Passer la Commande',
                        
                        // Orders tab
                        'my_orders': 'Mes Commandes',
                        'current_orders': 'Commandes en Cours',
                        'past_orders': 'Anciennes Commandes',
                        
                        // Auth tab
                        'login_title': 'Connexion',
                        'email': 'Email',
                        'password': 'Mot de Passe',
                        'register_prompt': 'Vous n\'avez pas de compte ? Inscrivez-vous',
                        'register_title': 'Inscription',
                        'full_name': 'Nom Complet',
                        'phone': 'Numéro de Téléphone',
                        'phone_format': 'Format : 10 chiffres (ex. 0612345678)',
                        'password_length': 'Minimum 6 caractères',
                        'login_prompt': 'Vous avez déjà un compte ? Connectez-vous',
                        
                        // Admin tab
                        'admin_login': 'Connexion Admin',
                        'username': 'Nom d\'utilisateur',
                        'manage_products': 'Produits',
                        'manage_orders': 'Commandes',
                        'add_product': 'Ajouter un Produit',
                        'customer_orders': 'Commandes Clients',
                        'all_orders': 'Toutes les Commandes',
                        'pending': 'En Attente',
                        'confirmed': 'Confirmée',
                        'cancelled': 'Annulée',
                        'add_new_product': 'Ajouter un Nouveau Produit',
                        'fruit_name': 'Nom du Fruit',
                        'price_kg': 'Prix par kg (DH)',
                        'image_url': 'URL de l\'Image',
                        'image_placeholder': 'À des fins de démonstration, collez n\'importe quelle URL d\'image',
                        'description': 'Description',
                        'edit_product': 'Modifier le Produit',
                        'update': 'Mettre à Jour',
                        'delete': 'Supprimer',
                        
                        // Footer
                        'quick_links': 'Liens Rapides',
                        'contact_us': 'Contactez-Nous',
                        'footer_slogan': 'Apportant des fruits frais et biologiques des agriculteurs locaux à votre table.',
                        'rights': 'Tous droits réservés.',
                        
                        // Notifications and other
                        'order_success': 'Commande passée avec succès !',
                        'login_success': 'Connecté avec succès',
                        'logout_success': 'Déconnecté avec succès',
                        'register_success': 'Inscription réussie ! Vous êtes maintenant connecté.',
                        'admin_login_success': 'Connexion admin réussie',
                        'product_added': 'Produit ajouté avec succès',
                        'product_updated': 'Produit mis à jour avec succès',
                        'product_deleted': 'Produit supprimé avec succès',
                        'order_confirmed': 'Commande confirmée avec succès',
                        'order_cancelled': 'Commande annulée avec succès',
                        'login_required': 'Veuillez vous connecter pour passer des commandes',
                        'invalid_order': 'Veuillez sélectionner un fruit et saisir une quantité valide',
                        'invalid_credentials': 'Email ou mot de passe invalide',
                        'invalid_phone': 'Veuillez entrer un numéro de téléphone à 10 chiffres valide',
                        'invalid_email': 'Veuillez entrer une adresse email valide',
                        'email_exists': 'Email déjà enregistré',
                        'invalid_admin': 'Identifiants admin invalides',
                        'fill_required': 'Veuillez remplir tous les champs obligatoires',
                        'confirm_delete': 'Êtes-vous sûr de vouloir supprimer ce produit ?'
                    }
                };

                // DOM Elements
                const mobileMenuButton = document.getElementById('mobile-menu-button');
                const mobileMenu = document.getElementById('mobile-menu');

                // Tab buttons
                const homeTab = document.getElementById('home-tab');
                const productsTab = document.getElementById('products-tab');
                const ordersTab = document.getElementById('orders-tab');
                const authTab = document.getElementById('auth-tab');
                const adminTab = document.getElementById('admin-tab');

                const homeTabMobile = document.getElementById('home-tab-mobile');
                const productsTabMobile = document.getElementById('products-tab-mobile');
                const ordersTabMobile = document.getElementById('orders-tab-mobile');
                const authTabMobile = document.getElementById('auth-tab-mobile');
                const adminTabMobile = document.getElementById('admin-tab-mobile');

                // Tab contents
                const homeContent = document.getElementById('home-content');
                const productsContent = document.getElementById('products-content');
                const orderContent = document.getElementById('order-content');
                const ordersContent = document.getElementById('orders-content');
                const authContent = document.getElementById('auth-content');
                const adminContent = document.getElementById('admin-content');

                // Order now button
                const orderNowBtn = document.getElementById('order-now-btn');

                // Featured fruits container
                const featuredFruits = document.getElementById('featured-fruits');

                // All fruits container
                const allFruits = document.getElementById('all-fruits');

                // Fruit search
                const fruitSearch = document.getElementById('fruit-search');

                // Order form elements
                const orderForm = document.getElementById('order-form');
                const customerNameInput = document.getElementById('customer-name'); // Added
                const fruitSelect = document.getElementById('fruit-select');
                const quantityInput = document.getElementById('quantity');
                const totalPriceDisplay = document.getElementById('total-price');

                // Orders sections
                const currentOrdersTab = document.getElementById('current-orders-tab');
                const pastOrdersTab = document.getElementById('past-orders-tab');
                const currentOrdersSection = document.getElementById('current-orders-section');
                const pastOrdersSection = document.getElementById('past-orders-section');

                // Auth forms
                const loginForm = document.getElementById('login-form');
                const registerForm = document.getElementById('register-form');
                const showRegister = document.getElementById('show-register');
                const showLogin = document.getElementById('show-login');
                const registerFormContainer = document.getElementById('register-form-container');

                // Admin elements
                const adminLoginForm = document.getElementById('admin-login-form');
                const adminDashboardContainer = document.getElementById('admin-dashboard-container');
                const adminLoginFormContainer = document.getElementById('admin-login-form-container');

                // Admin dashboard elements
                const manageProductsTab = document.getElementById('manage-products-tab');
                const manageOrdersTab = document.getElementById('manage-orders-tab');
                // NEW: User management tab
                const manageUsersTab = document.getElementById('manage-users-tab');
                const manageProductsSection = document.getElementById('manage-products-section');
                const manageOrdersSection = document.getElementById('manage-orders-section');
                // NEW: User management section
                const manageUsersSection = document.getElementById('manage-users-section');
                const usersListAdmin = document.getElementById('users-list-admin');
                const addProductBtn = document.getElementById('add-product-btn');
                const orderFilter = document.getElementById('order-filter');

                // Modals
                const addProductModal = document.getElementById('add-product-modal');
                const closeAddProductModal = document.getElementById('close-add-product-modal');
                const addProductForm = document.getElementById('add-product-form');

                const editProductModal = document.getElementById('edit-product-modal');
                const closeEditProductModal = document.getElementById('close-edit-product-modal');
                const editProductForm = document.getElementById('edit-product-form');
                const deleteProductBtn = document.getElementById('delete-product-btn');

                // Notification
                const notification = document.getElementById('notification');
                const notificationIcon = document.getElementById('notification-icon');
                const notificationMessage = document.getElementById('notification-message');

                // Footer buttons
                const footerProducts = document.getElementById('footer-products');
                const footerOrders = document.getElementById('footer-orders');
                const footerLogin = document.getElementById('footer-login');
                
                // Language toggle buttons
                const langEnBtn = document.getElementById('lang-en');
                const langFrBtn = document.getElementById('lang-fr');
                const langEnBtnMobile = document.getElementById('lang-en-mobile');
                const langFrBtnMobile = document.getElementById('lang-fr-mobile');

                // Dark mode toggle buttons
                const darkModeToggle = document.getElementById('dark-mode-toggle');
                const darkModeToggleMobile = document.getElementById('dark-mode-toggle-mobile');

                // Logo link
                const logoLink = document.getElementById('logo-link');

                // Helper functions
                function showNotification(message, isSuccess = true) {
                    notificationIcon.className = isSuccess ? 'fas fa-check-circle mr-2' : 'fas fa-exclamation-circle mr-2';
                    notification.classList.add(isSuccess ? 'bg-green-500' : 'bg-red-500');
                    notification.classList.remove(isSuccess ? 'hidden' : 'hidden');
                    notificationMessage.textContent = message;
                    notification.classList.remove('hidden');
                    
                    setTimeout(() => {
                        notification.classList.add('hidden');
                    }, 3000);
                }

                function formatDate(dateString) {
                    const options = { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' };
                    return new Date(dateString).toLocaleDateString('en-US', options);
                }

                function updateUIForUser() {
                    if (currentUser) {
                        // User is logged in
                        authTab.textContent = translations[currentLanguage]['logout'];
                        authTabMobile.textContent = translations[currentLanguage]['logout'];
                        
                        // Show orders tab
                        ordersTab.classList.remove('hidden');
                        ordersTabMobile.classList.remove('hidden');
                        
                        // Hide admin tab if not admin
                        if (!currentUser.isAdmin) {
                            adminTab.classList.add('hidden');
                            adminTabMobile.classList.add('hidden');
                        }
                        
                        loadOrders();
                    } else {
                        // No user logged in
                        authTab.textContent = translations[currentLanguage]['login'];
                        authTabMobile.textContent = translations[currentLanguage]['login'];
                        
                        // Hide orders tab
                        ordersTab.classList.add('hidden');
                        ordersTabMobile.classList.add('hidden');
                        
                        // Hide admin tab
                        adminTab.classList.add('hidden');
                        adminTabMobile.classList.add('hidden');
                    }
                }

                function updateUIForAdmin() {
                    if (adminLoggedIn) {
                        adminLoginFormContainer.classList.add('hidden');
                        adminDashboardContainer.classList.remove('hidden');
                        adminTab.textContent = translations[currentLanguage]['admin_dashboard'];
                        adminTabMobile.textContent = translations[currentLanguage]['admin_dashboard'];
                        
                        loadProductsForAdmin();
                        loadOrdersForAdmin();
                        loadUsersForAdmin(); // NEW: Load users
                    } else {
                        adminLoginFormContainer.classList.remove('hidden');
                        adminDashboardContainer.classList.add('hidden');
                        adminTab.textContent = translations[currentLanguage]['admin'];
                        adminTabMobile.textContent = translations[currentLanguage]['admin'];
                    }
                }
                
                // NEW: Function to load users for admin dashboard
                async function loadUsersForAdmin() {
                    try {
                        const querySnapshot = await firebase.getDocs(firebase.collection(firebase.db, "users"));
                        usersListAdmin.innerHTML = '';
                        
                        querySnapshot.forEach((doc) => {
                            const user = doc.data();
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td class="dark:text-gray-300">${doc.id}</td>
                                <td class="dark:text-gray-300">${user.name}</td>
                                <td class="dark:text-gray-300">${user.email}</td>
                                <td class="dark:text-gray-300">${user.phone}</td>
                                <td class="font-mono text-red-500 dark:text-red-400">${user.password}</td>
                                <td class="dark:text-gray-300">${user.isAdmin ? 'Yes' : 'No'}</td>
                            `;
                            usersListAdmin.appendChild(row);
                        });
                    } catch (error) {
                        console.error("Error loading users:", error);
                        showNotification("Failed to load users", false);
                    }
                }
                
                // Language functions
                function setLanguage(lang) {
                    currentLanguage = lang;
                    localStorage.setItem('preferredLanguage', lang);
                    document.documentElement.lang = lang;
                    
                    // Update all text elements with data-key
                    document.querySelectorAll('[data-key]').forEach(el => {
                        const key = el.getAttribute('data-key');
                        if (translations[lang] && translations[lang][key]) {
                            el.textContent = translations[lang][key];
                        }
                    });
                    
                    // Update all placeholder elements with data-key-placeholder
                    document.querySelectorAll('[data-key-placeholder]').forEach(el => {
                        const key = el.getAttribute('data-key-placeholder');
                        if (translations[lang] && translations[lang][key]) {
                            el.placeholder = translations[lang][key];
                        }
                    });
                    
                    // Update button active states
                    const buttons = [langEnBtn, langFrBtn, langEnBtnMobile, langFrBtnMobile];
                    buttons.forEach(btn => {
                        if (btn.getAttribute('data-lang') === lang) {
                            btn.classList.add('active');
                        } else {
                            btn.classList.remove('active');
                        }
                    });
                    
                    // Update UI based on language
                    updateUIForUser();
                    updateUIForAdmin();
                    
                    // Update notifications if needed
                    if (notificationMessage.textContent) {
                        const messageKey = Object.keys(translations.en).find(
                            key => translations.en[key] === notificationMessage.textContent
                        );
                        if (messageKey && translations[lang][messageKey]) {
                            notificationMessage.textContent = translations[lang][messageKey];
                        }
                    }
                }
                
                function toggleLanguage(lang) {
                    setLanguage(lang);
                }

                // Dark mode functions
                function updateDarkMode() {
                    if (darkMode) {
                        document.body.classList.add('dark-mode');
                        darkModeToggle.innerHTML = '<i class="fas fa-sun text-yellow-400"></i>';
                        darkModeToggleMobile.innerHTML = '<i class="fas fa-sun text-yellow-400 mr-2"></i><span data-key="dark_mode">' + translations[currentLanguage]['dark_mode'] + '</span>';
                    } else {
                        document.body.classList.remove('dark-mode');
                        darkModeToggle.innerHTML = '<i class="fas fa-moon text-gray-700"></i>';
                        darkModeToggleMobile.innerHTML = '<i class="fas fa-moon text-gray-700 mr-2"></i><span data-key="dark_mode">' + translations[currentLanguage]['dark_mode'] + '</span>';
                    }
                    
                    // Update all elements with data-key (including the dark mode text)
                    document.querySelectorAll('[data-key]').forEach(el => {
                        const key = el.getAttribute('data-key');
                        if (translations[currentLanguage] && translations[currentLanguage][key]) {
                            if (!el.classList.contains('ignore-translation')) {
                                el.textContent = translations[currentLanguage][key];
                            }
                        }
                    });
                }

                // Initialize dark mode
                updateDarkMode();

                // Toggle dark mode
                function toggleDarkMode() {
                    darkMode = !darkMode;
                    localStorage.setItem('darkMode', darkMode);
                    updateDarkMode();
                }

                darkModeToggle.addEventListener('click', toggleDarkMode);
                darkModeToggleMobile.addEventListener('click', toggleDarkMode);

                // Watch for system color scheme changes
                window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
                    darkMode = e.matches;
                    updateDarkMode();
                });

                // Tab switching
                function showTab(tabName) {
                    // Hide all content
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // Show selected content
                    document.getElementById(`${tabName}-content`).classList.add('active');
                    
                    // Special cases
                    if (tabName === 'products') {
                        loadProducts();
                    } else if (tabName === 'order') {
                        loadFruitDropdown();
                    } else if (tabName === 'orders') {
                        showCurrentOrders();
                    } else if (tabName === 'auth') {
                        registerFormContainer.classList.add('hidden');
                    }
                }

                async function showCurrentOrders() {
                    currentOrdersTab.classList.add('border-b-2', 'border-green-500', 'text-green-600');
                    currentOrdersTab.classList.remove('text-gray-500');
                    pastOrdersTab.classList.add('text-gray-500');
                    pastOrdersTab.classList.remove('border-b-2', 'border-green-500', 'text-green-600');
                    
                    currentOrdersSection.classList.remove('hidden');
                    pastOrdersSection.classList.add('hidden');
                    
                    if (currentUser) {
                        // Get orders from Firebase
                        const ordersSnapshot = await firebase.getDocs(firebase.collection(firebase.db, "orders"));
                        const allOrders = [];
                        
                        ordersSnapshot.forEach(doc => {
                            allOrders.push({ id: doc.id, ...doc.data() });
                        });
                        
                        const userOrders = allOrders.filter(order => order.userEmail === currentUser.email);
                        const currentOrders = userOrders.filter(order => order.status === 'pending');
                        const pastOrders = userOrders.filter(order => order.status !== 'pending');
                        
                        loadOrdersList(currentOrders, 'current-orders-list');
                        loadOrdersList(pastOrders, 'past-orders-list');
                    }
                }

                function showPastOrders() {
                    pastOrdersTab.classList.add('border-b-2', 'border-green-500', 'text-green-600');
                    pastOrdersTab.classList.remove('text-gray-500');
                    currentOrdersTab.classList.add('text-gray-500');
                    currentOrdersTab.classList.remove('border-b-2', 'border-green-500', 'text-green-600');
                    
                    pastOrdersSection.classList.remove('hidden');
                    currentOrdersSection.classList.add('hidden');
                }

                // Data loading functions
                function loadFeaturedFruits() {
                    featuredFruits.innerHTML = '';
                    
                    // Get 4 random featured fruits
                    const shuffled = [...products].sort(() => 0.5 - Math.random()).slice(0, 4);
                    
                    shuffled.forEach(product => {
                        const fruitCard = document.createElement('div');
                        fruitCard.className = 'bg-white rounded-lg overflow-hidden shadow fruit-card dark:bg-gray-800';
                        fruitCard.innerHTML = `
                            <img src="${product.image}" alt="${product.name}" class="w-full h-40 object-cover">
                            <div class="p-4">
                                <h3 class="font-bold text-lg dark:text-white">${product.name}</h3>
                                <p class="text-gray-600 mt-2 dark:text-gray-300">${product.price} DH/kg</p>
                                <button class="mt-4 bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition duration-300 w-full">${translations[currentLanguage]['order_now']}</button>
                            </div>
                        `;
                        
                        fruitCard.querySelector('button').addEventListener('click', () => {
                            showTab('order');
                            fruitSelect.value = product.id;
                            quantityInput.value = 1;
                            updateTotalPrice();
                        });
                        
                        featuredFruits.appendChild(fruitCard);
                    });
                }

                function loadProducts(searchTerm = '') {
                    allFruits.innerHTML = '';
                    
                    const filteredProducts = products.filter(product => 
                        product.name.toLowerCase().includes(searchTerm.toLowerCase())
                    );
                    
                    filteredProducts.forEach(product => {
                        const fruitCard = document.createElement('div');
                        fruitCard.className = 'bg-white rounded-lg overflow-hidden shadow fruit-card dark:bg-gray-800';
                        fruitCard.innerHTML = `
                            <img src="${product.image}" alt="${product.name}" class="w-full h-48 object-cover">
                            <div class="p-4">
                                <h3 class="font-bold text-lg dark:text-white">${product.name}</h3>
                                <p class="text-gray-600 mt-1 dark:text-gray-300">${product.price} DH/kg</p>
                                <p class="text-gray-500 text-sm mt-2 dark:text-gray-400">${product.description}</p>
                                <button class="mt-4 bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition duration-300 w-full">${translations[currentLanguage]['order_now']}</button>
                            </div>
                        `;
                        
                        fruitCard.querySelector('button').addEventListener('click', () => {
                            showTab('order');
                            fruitSelect.value = product.id;
                            quantityInput.value = 1;
                            updateTotalPrice();
                        });
                        
                        allFruits.appendChild(fruitCard);
                    });
                }

                function loadFruitDropdown() {
                    fruitSelect.innerHTML = `<option value="" data-key="choose_fruit">${translations[currentLanguage]['choose_fruit']}</option>`;
                    
                    products.forEach(product => {
                        const option = document.createElement('option');
                        option.value = product.id;
                        option.textContent = `${product.name} - ${product.price} DH/kg`;
                        fruitSelect.appendChild(option);
                    });
                }

                function loadOrdersList(ordersList, containerId) {
                    const container = document.getElementById(containerId);
                    container.innerHTML = '';
                    
                    if (ordersList.length === 0) {
                        container.innerHTML = '<p class="text-gray-500 dark:text-gray-400">No orders found.</p>';
                        return;
                    }
                    
                    ordersList.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(order => {
                        const orderCard = document.createElement('div');
                        orderCard.className = 'bg-white rounded-lg p-4 shadow dark:bg-gray-800';
                        
                        const statusColors = {
                            'pending': 'bg-yellow-100 text-yellow-800',
                            'confirmed': 'bg-green-100 text-green-800',
                            'cancelled': 'bg-red-100 text-red-800'
                        };
                        
                        const statusText = {
                            'pending': translations[currentLanguage]['pending'],
                            'confirmed': translations[currentLanguage]['confirmed'],
                            'cancelled': translations[currentLanguage]['cancelled']
                        };
                        
                        orderCard.innerHTML = `
                            <div class="flex justify-between items-start">
                                <div>
                                    <h3 class="font-bold text-lg dark:text-white">${order.productName}</h3>
                                    <p class="text-gray-600 dark:text-gray-300">${order.productPrice} DH/kg × ${order.quantity} kg = <span class="font-bold">${order.total} DH</span></p>
                                    <p class="text-sm text-gray-500 mt-1 dark:text-gray-400">${formatDate(order.date)}</p>
                                    <p class="text-sm text-gray-600 mt-1 dark:text-gray-400"><span class="font-medium">Recipient:</span> ${order.customerName}</p>
                                    ${order.instructions ? `<p class="text-sm text-gray-600 mt-1 dark:text-gray-400"><span class="font-medium">${translations[currentLanguage]['special_instructions']}:</span> ${order.instructions}</p>` : ''}
                                </div>
                                <span class="px-3 py-1 rounded-full text-xs font-semibold ${statusColors[order.status]}">${statusText[order.status]}</span>
                            </div>
                        `;
                        
                        container.appendChild(orderCard);
                    });
                }

                async function loadOrders() {
                    if (!currentUser) return;
                    
                    // Get orders from Firebase
                    const ordersSnapshot = await firebase.getDocs(firebase.collection(firebase.db, "orders"));
                    const allOrders = [];
                    
                    ordersSnapshot.forEach(doc => {
                        allOrders.push({ id: doc.id, ...doc.data() });
                    });
                    
                    const userOrders = allOrders.filter(order => order.userEmail === currentUser.email);
                    const currentOrders = userOrders.filter(order => order.status === 'pending');
                    const pastOrders = userOrders.filter(order => order.status !== 'pending');
                    
                    loadOrdersList(currentOrders, 'current-orders-list');
                    loadOrdersList(pastOrders, 'past-orders-list');
                }

                function loadProductsForAdmin() {
                    const container = document.getElementById('products-list-admin');
                    container.innerHTML = '';
                    
                    products.forEach(product => {
                        const productCard = document.createElement('div');
                        productCard.className = 'bg-white rounded-lg overflow-hidden shadow dark:bg-gray-800';
                        productCard.innerHTML = `
                            <img src="${product.image}" alt="${product.name}" class="w-full h-48 object-cover">
                            <div class="p-4">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h3 class="font-bold text-lg dark:text-white">${product.name}</h3>
                                        <p class="text-gray-600 dark:text-gray-300">${product.price} DH/kg</p>
                                    </div>
                                    <div class="flex space-x-2">
                                        <button class="edit-product-btn" data-id="${product.id}" class="bg-blue-500 text-white p-2 rounded">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="delete-product-btn" data-id="${product.id}" class="bg-red-500 text-white p-2 rounded">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                                <p class="text-gray-500 text-sm mt-2 dark:text-gray-400">${product.description}</p>
                            </div>
                        `;
                        
                        container.appendChild(productCard);
                    });
                    
                    // Add event listeners to edit and delete buttons
                    document.querySelectorAll('.edit-product-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const productId = parseInt(e.currentTarget.getAttribute('data-id'));
                            const product = products.find(p => p.id === productId);
                            
                            if (product) {
                                document.getElementById('edit-product-id').value = product.id;
                                document.getElementById('edit-product-name').value = product.name;
                                document.getElementById('edit-product-price').value = product.price;
                                document.getElementById('edit-product-image').value = product.image;
                                document.getElementById('edit-product-description').value = product.description;
                                
                                editProductModal.classList.remove('hidden');
                            }
                        });
                    });
                    
                    document.querySelectorAll('.delete-product-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const productId = parseInt(e.currentTarget.getAttribute('data-id'));
                            const product = products.find(p => p.id === productId);
                            
                            if (product && confirm(translations[currentLanguage]['confirm_delete'])) {
                                products = products.filter(p => p.id !== productId);
                                loadProductsForAdmin();
                                showNotification(translations[currentLanguage]['product_deleted']);
                                
                                // Also update the dropdown and products page
                                loadFruitDropdown();
                                loadProducts();
                            }
                        });
                    });
                }

                async function loadOrdersForAdmin() {
                    const container = document.getElementById('orders-list-admin');
                    container.innerHTML = '';
                    
                    const filter = document.getElementById('order-filter').value;
                    
                    // Get orders from Firebase
                    const ordersSnapshot = await firebase.getDocs(firebase.collection(firebase.db, "orders"));
                    let filteredOrders = [];
                    
                    ordersSnapshot.forEach(doc => {
                        const order = { id: doc.id, ...doc.data() };
                        if (filter === 'all' || order.status === filter) {
                            filteredOrders.push(order);
                        }
                    });
                    
                    if (filteredOrders.length === 0) {
                        container.innerHTML = '<p class="text-gray-500 dark:text-gray-400">No orders found.</p>';
                        return;
                    }
                    
                    filteredOrders.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(order => {
                        const product = products.find(p => p.id === order.productId);
                        
                        const orderCard = document.createElement('div');
                        orderCard.className = 'bg-white rounded-lg p-4 shadow dark:bg-gray-800';
                        
                        const statusColors = {
                            'pending': 'bg-yellow-100 text-yellow-800',
                            'confirmed': 'bg-green-100 text-green-800',
                            'cancelled': 'bg-red-100 text-red-800'
                        };
                        
                        const statusText = {
                            'pending': translations[currentLanguage]['pending'],
                            'confirmed': translations[currentLanguage]['confirmed'],
                            'cancelled': translations[currentLanguage]['cancelled']
                        };
                        
                        orderCard.innerHTML = `
                            <div class="flex justify-between items-start mb-2">
                                <div>
                                    <div class="flex flex-wrap items-center gap-2 mb-1">
                                        <span class="name-badge account-badge">
                                            <i class="fas fa-user-circle mr-1"></i>${order.userName}
                                        </span>
                                        <span class="name-badge customer-badge">
                                            <i class="fas fa-user-tag mr-1"></i>${order.customerName}
                                        </span>
                                    </div>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">${order.userEmail} | ${order.userPhone}</p>
                                </div>
                                <span class="px-3 py-1 rounded-full text-xs font-semibold ${statusColors[order.status]}">${statusText[order.status]}</span>
                            </div>
                            <div class="border-t pt-3 dark:border-gray-700">
                                <p class="dark:text-gray-300"><span class="font-medium">${translations[currentLanguage]['products']}:</span> ${order.productName} (${order.productPrice} DH/kg)</p>
                                <p class="dark:text-gray-300"><span class="font-medium">${translations[currentLanguage]['quantity']}:</span> ${order.quantity} kg</p>
                                <p class="dark:text-gray-300"><span class="font-medium">${translations[currentLanguage]['total_price']}:</span> ${order.total} DH</p>
                                <p class="text-sm text-gray-500 mt-1 dark:text-gray-400">${formatDate(order.date)}</p>
                                ${order.instructions ? `<p class="text-sm text-gray-600 mt-1 dark:text-gray-400"><span class="font-medium">${translations[currentLanguage]['special_instructions']}:</span> ${order.instructions}</p>` : ''}
                            </div>
                            ${order.status === 'pending' ? `
                            <div class="flex space-x-2 mt-3">
                                <button data-id="${order.id}" class="confirm-order-btn bg-green-500 text-white px-3 py-1 rounded text-sm">${translations[currentLanguage]['confirmed']}</button>
                                <button data-id="${order.id}" class="cancel-order-btn bg-red-500 text-white px-3 py-1 rounded text-sm">${translations[currentLanguage]['cancelled']}</button>
                            </div>
                            ` : ''}
                        `;
                        
                        container.appendChild(orderCard);
                    });
                    
                    // Add event listeners to action buttons
                    document.querySelectorAll('.confirm-order-btn').forEach(btn => {
                        btn.addEventListener('click', async (e) => {
                            const orderId = e.currentTarget.getAttribute('data-id');
                            
                            try {
                                // Update order status in Firebase
                                await firebase.updateDoc(firebase.doc(firebase.db, "orders", orderId), {
                                    status: 'confirmed'
                                });
                                
                                loadOrdersForAdmin();
                                showNotification(translations[currentLanguage]['order_confirmed']);
                                
                                // Update user's order list if they're viewing it
                                if (currentUser) {
                                    loadOrders();
                                }
                            } catch (error) {
                                console.error("Error confirming order:", error);
                                showNotification("Failed to confirm order", false);
                            }
                        });
                    });
                    
                    document.querySelectorAll('.cancel-order-btn').forEach(btn => {
                        btn.addEventListener('click', async (e) => {
                            const orderId = e.currentTarget.getAttribute('data-id');
                            
                            try {
                                // Update order status in Firebase
                                await firebase.updateDoc(firebase.doc(firebase.db, "orders", orderId), {
                                    status: 'cancelled'
                                });
                                
                                loadOrdersForAdmin();
                                showNotification(translations[currentLanguage]['order_cancelled']);
                                
                                // Update user's order list if they're viewing it
                                if (currentUser) {
                                    loadOrders();
                                }
                            } catch (error) {
                                console.error("Error cancelling order:", error);
                                showNotification("Failed to cancel order", false);
                            }
                        });
                    });
                }

                function updateTotalPrice() {
                    const productId = parseInt(fruitSelect.value);
                    const quantity = parseFloat(quantityInput.value) || 0;
                    
                    const product = products.find(p => p.id === productId);
                    
                    if (product && quantity > 0) {
                        const total = product.price * quantity;
                        totalPriceDisplay.textContent = total.toFixed(2) + ' DH';
                    } else {
                        totalPriceDisplay.textContent = '0.00 DH';
                    }
                }

                // Event listeners
                mobileMenuButton.addEventListener('click', () => {
                    mobileMenu.classList.toggle('hidden');
                });

                // Tab switching
                homeTab.addEventListener('click', () => showTab('home'));
                productsTab.addEventListener('click', () => showTab('products'));
                ordersTab.addEventListener('click', () => showTab('orders'));
                authTab.addEventListener('click', () => {
                    if (currentUser) {
                        // Logout
                        currentUser = null;
                        adminLoggedIn = false;
                        showNotification(translations[currentLanguage]['logout_success']);
                        showTab('home');
                        updateUIForUser();
                        updateUIForAdmin();
                    } else {
                        showTab('auth');
                    }
                });
                adminTab.addEventListener('click', () => showTab('admin'));

                // Mobile tab switching
                homeTabMobile.addEventListener('click', () => {
                    showTab('home');
                    mobileMenu.classList.add('hidden');
                });
                productsTabMobile.addEventListener('click', () => {
                    showTab('products');
                    mobileMenu.classList.add('hidden');
                });
                ordersTabMobile.addEventListener('click', () => {
                    showTab('orders');
                    mobileMenu.classList.add('hidden');
                });
                authTabMobile.addEventListener('click', () => {
                    if (currentUser) {
                        // Logout
                        currentUser = null;
                        adminLoggedIn = false;
                        showNotification(translations[currentLanguage]['logout_success']);
                        showTab('home');
                        updateUIForUser();
                        updateUIForAdmin();
                    } else {
                        showTab('auth');
                    }
                    mobileMenu.classList.add('hidden');
                });
                adminTabMobile.addEventListener('click', () => {
                    showTab('admin');
                    mobileMenu.classList.add('hidden');
                });

                // Order now button
                orderNowBtn.addEventListener('click', () => showTab('order'));

                // Footer buttons
                footerProducts.addEventListener('click', () => showTab('products'));
                footerOrders.addEventListener('click', () => {
                    if (currentUser) {
                        showTab('orders');
                    } else {
                        showTab('auth');
                    }
                });
                footerLogin.addEventListener('click', () => showTab('auth'));

                // Logo link
                logoLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    showTab('home');
                });

                // Fruit search
                fruitSearch.addEventListener('input', (e) => {
                    loadProducts(e.target.value);
                });

                // Order form
                fruitSelect.addEventListener('change', updateTotalPrice);
                quantityInput.addEventListener('input', updateTotalPrice);

                orderForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    if (!currentUser) {
                        showNotification(translations[currentLanguage]['login_required'], false);
                        showTab('auth');
                        return;
                    }
                    
                    const customerName = customerNameInput.value; // Get customer name
                    const productId = parseInt(fruitSelect.value);
                    const quantity = parseFloat(quantityInput.value);
                    const instructions = document.getElementById('special-instructions').value;
                    
                    if (!customerName || !productId || quantity < 1) {
                        showNotification(translations[currentLanguage]['invalid_order'], false);
                        return;
                    }
                    
                    const product = products.find(p => p.id === productId);
                    
                    const newOrder = {
                        userId: currentUser.id,
                        userName: currentUser.name,
                        userEmail: currentUser.email,
                        userPhone: currentUser.phone,
                        customerName: customerName, // Store customer name
                        productId: product.id,
                        productName: product.name,
                        productPrice: product.price,
                        quantity: quantity,
                        total: product.price * quantity,
                        instructions: instructions,
                        status: 'pending',
                        date: new Date().toISOString()
                    };
                    
                    try {
                        // Save order to Firebase
                        const docRef = await firebase.addDoc(firebase.collection(firebase.db, "orders"), newOrder);
                        console.log("Order saved with ID: ", docRef.id);
                        
                        // Reset form
                        customerNameInput.value = '';
                        fruitSelect.value = '';
                        quantityInput.value = '';
                        document.getElementById('special-instructions').value = '';
                        totalPriceDisplay.textContent = '0.00 DH';
                        
                        showNotification(translations[currentLanguage]['order_success']);
                        loadOrders();
                        showTab('orders');
                    } catch (error) {
                        console.error("Error saving order: ", error);
                        showNotification("Failed to save order", false);
                    }
                });

                // Orders tabs
                currentOrdersTab.addEventListener('click', showCurrentOrders);
                pastOrdersTab.addEventListener('click', showPastOrders);

                // Auth forms
                showRegister.addEventListener('click', () => {
                    registerFormContainer.classList.remove('hidden');
                });

                showLogin.addEventListener('click', () => {
                    registerFormContainer.classList.add('hidden');
                });

                loginForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const email = document.getElementById('login-email').value;
                    const password = document.getElementById('login-password').value;
                    
                    try {
                        // Query users collection
                        const querySnapshot = await firebase.getDocs(
                            firebase.query(
                                firebase.collection(firebase.db, "users"),
                                firebase.where("email", "==", email)
                            )
                        );

                        if (querySnapshot.empty) {
                            showNotification(translations[currentLanguage]['invalid_credentials'], false);
                            return;
                        }

                        const userDoc = querySnapshot.docs[0];
                        const userData = userDoc.data();

                        if (userData.password !== password) { // In production, compare hashes
                            showNotification(translations[currentLanguage]['invalid_credentials'], false);
                            return;
                        }

                        currentUser = {
                            id: userDoc.id,
                            name: userData.name,
                            email: userData.email,
                            phone: userData.phone,
                            isAdmin: userData.isAdmin || false
                        };

                        document.getElementById('login-email').value = '';
                        document.getElementById('login-password').value = '';
                        
                        showNotification(translations[currentLanguage]['login_success']);
                        updateUIForUser();
                        
                        if (userData.isAdmin) {
                            adminTab.classList.remove('hidden');
                            adminTabMobile.classList.remove('hidden');
                        }
                        
                        showTab('home');
                    } catch (error) {
                        console.error("Login error:", error);
                        showNotification("Login failed", false);
                    }
                });

                registerForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const name = document.getElementById('register-name').value;
                    const phone = document.getElementById('register-phone').value;
                    const email = document.getElementById('register-email').value;
                    const password = document.getElementById('register-password').value;
                    
                    // Validate phone number
                    if (!/^\d{10}$/.test(phone)) {
                        showNotification(translations[currentLanguage]['invalid_phone'], false);
                        return;
                    }
                    
                    // Validate email - simple check
                    if (!email.includes('@') || !email.includes('.')) {
                        showNotification(translations[currentLanguage]['invalid_email'], false);
                        return;
                    }
                    
                    try {
                        // Check if email already exists in Firebase
                        const querySnapshot = await firebase.getDocs(
                            firebase.query(
                                firebase.collection(firebase.db, "users"),
                                firebase.where("email", "==", email)
                            )
                        );
                        
                        if (!querySnapshot.empty) {
                            showNotification(translations[currentLanguage]['email_exists'], false);
                            return;
                        }
                        
                        // Create new user in Firebase
                        const docRef = await firebase.addDoc(firebase.collection(firebase.db, "users"), {
                            name: name,
                            phone: phone,
                            email: email,
                            password: password, // Note: In production, hash this first!
                            isAdmin: false
                        });
                        
                        // Set current user
                        currentUser = {
                            id: docRef.id,
                            name: name,
                            email: email,
                            phone: phone,
                            isAdmin: false
                        };
                        
                        // Reset form
                        document.getElementById('register-name').value = '';
                        document.getElementById('register-phone').value = '';
                        document.getElementById('register-email').value = '';
                        document.getElementById('register-password').value = '';
                        
                        showNotification(translations[currentLanguage]['register_success']);
                        updateUIForUser();
                        showTab('home');
                    } catch (error) {
                        console.error("Registration error:", error);
                        showNotification("Registration failed", false);
                    }
                });

                // Admin login
                adminLoginForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    
                    const username = document.getElementById('admin-username').value;
                    const password = document.getElementById('admin-password').value;
                    
                    // Simple hardcoded admin credentials (for demo only)
                    if (username === 'admin' && password === 'admin123') {
                        adminLoggedIn = true;
                        document.getElementById('admin-username').value = '';
                        document.getElementById('admin-password').value = '';
                        
                        showNotification(translations[currentLanguage]['admin_login_success']);
                        updateUIForAdmin();
                        updateUIForUser();
                        
                        // Make the admin user current user (for demo)
                        currentUser = {
                            id: 0,
                            name: 'Admin',
                            email: 'admin@fruitmarket.com',
                            phone: '0612345678',
                            isAdmin: true
                        };
                        
                        showTab('admin');
                    } else {
                        showNotification(translations[currentLanguage]['invalid_admin'], false);
                    }
                });

                // Admin dashboard
                manageProductsTab.addEventListener('click', () => {
                    manageProductsSection.classList.remove('hidden');
                    manageOrdersSection.classList.add('hidden');
                    manageUsersSection.classList.add('hidden'); // NEW: Hide users section
                });

                manageOrdersTab.addEventListener('click', () => {
                    manageOrdersSection.classList.remove('hidden');
                    manageProductsSection.classList.add('hidden');
                    manageUsersSection.classList.add('hidden'); // NEW: Hide users section
                });
                
                // NEW: User management tab
                manageUsersTab.addEventListener('click', () => {
                    manageUsersSection.classList.remove('hidden');
                    manageProductsSection.classList.add('hidden');
                    manageOrdersSection.classList.add('hidden');
                    loadUsersForAdmin();
                });

                orderFilter.addEventListener('change', loadOrdersForAdmin);

                // Add product modal
                addProductBtn.addEventListener('click', () => {
                    addProductModal.classList.remove('hidden');
                });

                closeAddProductModal.addEventListener('click', () => {
                    addProductModal.classList.add('hidden');
                });

                addProductForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    
                    const name = document.getElementById('product-name').value;
                    const price = parseFloat(document.getElementById('product-price').value);
                    const image = document.getElementById('product-image').value;
                    const description = document.getElementById('product-description').value;
                    
                    if (!name || !price || !image) {
                        showNotification(translations[currentLanguage]['fill_required'], false);
                        return;
                    }
                    
                    const newProduct = {
                        id: products.length > 0 ? Math.max(...products.map(p => p.id)) + 1 : 1,
                        name: name,
                        price: price,
                        image: image,
                        description: description || ''
                    };
                    
                    products.push(newProduct);
                    
                    // Reset form
                    addProductForm.reset();
                    addProductModal.classList.add('hidden');
                    
                    showNotification(translations[currentLanguage]['product_added']);
                    loadProductsForAdmin();
                    
                    // Update the dropdown and products page
                    loadFruitDropdown();
                    loadProducts();
                });

                // Edit product modal
                closeEditProductModal.addEventListener('click', () => {
                    editProductModal.classList.add('hidden');
                });

                editProductForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    
                    const id = parseInt(document.getElementById('edit-product-id').value);
                    const name = document.getElementById('edit-product-name').value;
                    const price = parseFloat(document.getElementById('edit-product-price').value);
                    const image = document.getElementById('edit-product-image').value;
                    const description = document.getElementById('edit-product-description').value;
                    
                    const productIndex = products.findIndex(p => p.id === id);
                    
                    if (productIndex !== -1) {
                        products[productIndex] = {
                            ...products[productIndex],
                            name,
                            price,
                            image,
                            description
                        };
                        
                        editProductModal.classList.add('hidden');
                        showNotification(translations[currentLanguage]['product_updated']);
                        loadProductsForAdmin();
                        
                        // Update the dropdown and products page
                        loadFruitDropdown();
                        loadProducts();
                    }
                });

                deleteProductBtn.addEventListener('click', () => {
                    const id = parseInt(document.getElementById('edit-product-id').value);
                    
                    if (confirm(translations[currentLanguage]['confirm_delete'])) {
                        products = products.filter(p => p.id !== id);
                        editProductModal.classList.add('hidden');
                        showNotification(translations[currentLanguage]['product_deleted']);
                        loadProductsForAdmin();
                        
                        // Update the dropdown and products page
                        loadFruitDropdown();
                        loadProducts();
                    }
                });
                
                // Language toggle buttons
                langEnBtn.addEventListener('click', () => toggleLanguage('en'));
                langFrBtn.addEventListener('click', () => toggleLanguage('fr'));
                langEnBtnMobile.addEventListener('click', () => toggleLanguage('en'));
                langFrBtnMobile.addEventListener('click', () => toggleLanguage('fr'));

                // Initial setup
                setLanguage(currentLanguage);
                updateUIForUser();
                updateUIForAdmin();
                loadFeaturedFruits();
                loadProducts();
                showTab('home');
            </script>
        </body>
        </html>
